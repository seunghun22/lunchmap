<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì™€ì´ì¦ˆì½”ì•„ ì ì‹¬ ë©”ë‰´ ì§€ë„</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #map {
      width: 100%;
      height: 70vh;
    }
    #lunch-recommendation {
      height: 25vh;
      padding: 35px 15px;
      background-color: #f9f9f9;
      border-top: 1px solid #ccc;
      text-align: center;
    }
    #recommend-button {
      padding: 5px 15px;
      font-size: 25px;
      cursor: pointer;
      margin-top: 5px;
      margin-bottom: 5px;
    }
    #result {
      font-size: 15px;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    #comment-box {
      display: none;
      padding: 20px;
      border-top: 1px solid #ccc;
      background-color: #fff;
      position: relative;
    }
    #comment-list p {
      margin: 5px 0;
    }
    .star {
      font-size: 25px;
      color: #ccc;
      cursor: pointer;
    }
    .star.selected {
      color: gold;
    }
    #rating-info {
      margin-top: 5px;
      font-size: 14px;
    }
    #rating-submit {
      margin-top: 10px;
    }
    #average-rating {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>

  <!-- ì§€ë„ -->
  <div id="map"></div>

  <!-- ì ì‹¬ ì¶”ì²œ ì˜ì—­ -->
  <div id="lunch-recommendation">
    <h2>ğŸ± ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</h2>
    <button id="recommend-button">ì ì‹¬ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
    <div id="result">ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!</div>
  </div>

  <!-- ëŒ“ê¸€ + ë³„ì  ì…ë ¥ì°½ -->
  <div id="comment-box">
    <h3 id="comment-title"></h3>

    <!-- í‰ê·  ë³„ì  (ì˜¤ë¥¸ìª½ ìƒë‹¨) -->
    <div id="average-rating">â­ í‰ê·  ë³„ì : - / 5</div>

    <!-- â­ ë³„ì  ì„ íƒ -->
    <div id="rating-stars">
      <span class="star" data-value="1">â˜…</span>
      <span class="star" data-value="2">â˜…</span>
      <span class="star" data-value="3">â˜…</span>
      <span class="star" data-value="4">â˜…</span>
      <span class="star" data-value="5">â˜…</span>
    </div>

    <div id="rating-info">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
    <button id="rating-submit">ë³„ì  ë“±ë¡</button>

    <!-- ëŒ“ê¸€ ëª©ë¡ -->
    <div id="comment-list"></div>

    <!-- ëŒ“ê¸€ ì…ë ¥ -->
    <textarea id="comment-input" rows="3" style="width:100%;"></textarea>
    <br>
    <button id="comment-submit">ëŒ“ê¸€ ë“±ë¡</button>
  </div>

  <!-- Kakao ì§€ë„ API -->
  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cbbbf1aa58bda1a4274eba3bcecf5ad8&autoload=false"></script>

  <!-- comment.js + rating.js ì—°ê²° -->
  <script src="{{ url_for('static', filename='js/comment.js') }}"></script>
  <script src="{{ url_for('static', filename='js/rating.js') }}"></script>

  <!-- ì§€ë„ ë° ì¶”ì²œ ê¸°ëŠ¥ -->
  <script>
    kakao.maps.load(function () {
      const mapContainer = document.getElementById('map');
      const mapOption = {
        center: new kakao.maps.LatLng(37.5089, 127.0226),
        level: 2
      };
      const map = new kakao.maps.Map(mapContainer, mapOption);

      const markerImage = new kakao.maps.MarkerImage(
        "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
        new kakao.maps.Size(36, 36)
      );

      const restaurants = [
        { name: "ì‹¸ë‹¤ê¹€ë°¥", lat: 37.510604190067994, lng: 127.02052018667223 },
        { name: "ë§ˆë‹˜ê¹€ë°¥", lat: 37.51081997319398, lng: 127.02300574881384 },
        { name: "ì €ìŠ¤íŠ¸ì¹´ì¸ ", lat: 37.5107478900872, lng: 127.02301986491916 },
        { name: "íƒ•íƒ•ì§‘", lat: 37.51064201820906, lng: 127.02303962589788 },
        { name: "ë¶€ëŒ€ì°Œê°œ", lat: 37.5101642869389, lng: 127.02403763026003 },
        { name: "ìˆœëŒ€êµ­", lat: 37.50963517755151, lng: 127.02287531540941 },
        { name: "ë³´ìŠ¹íšŒê´€", lat: 37.50850679867281, lng: 127.02219635636679 },
        { name: "íšŒë®ë°¥,ì•Œë°¥", lat: 37.50782845013411, lng: 127.02394922764212 },
        { name: "ì„œë¸Œì›¨ì´", lat: 37.50950926196295, lng: 127.02168203016542 },
        { name: "ë¼ˆí•´ì¥êµ­ì§‘", lat: 37.51097097543822, lng: 127.02257033640775 },
        { name: "ë³¸ì£½,ë¹„ë¹”ë°¥", lat: 37.510563108050185, lng: 127.02340719469315 },
        { name: "ìˆœë‘ë¶€", lat: 37.510491022649205, lng: 127.02343262090795 },
        { name: "ìŒ€êµ­ìˆ˜", lat: 37.51081583910813, lng: 127.02101508308174 },
        { name: "ì‹œì¥ ë¶„ì‹ êµ­ìˆ˜", lat: 37.509621530803585, lng: 127.0235454532333 },
        { name: "ì œìœ¡,ê¹€ì¹˜ì°Œê°œ", lat: 37.51009019196013, lng: 127.02283869519349 },
        { name: "ì†êµ­ì‹œ", lat: 37.509986531382246, lng: 127.02307052821175 },
        { name: "í•¨ë°”ì§‘,í•œì‹ë·”í˜?", lat: 37.50976133295169, lng: 127.02279900847579 },
        { name: "ë§ˆë¼íƒ•", lat:  37.510382583361285, lng: 127.02498778462514 }
      ];

      let currentInfoWindow = null;

      restaurants.forEach(r => {
        const marker = new kakao.maps.Marker({
          position: new kakao.maps.LatLng(r.lat, r.lng),
          map: map,
          title: r.name,
          image: markerImage
        });

        const infoWindow = new kakao.maps.InfoWindow({
          content: `<div style="padding:8px; font-size:16px;">
                      ${r.name}<br>
                      <button onclick="showComments('${r.name}')">ëŒ“ê¸€ ë³´ê¸°</button>
                      <button onclick="showRating('${r.name}')">ë³„ì  ë³´ê¸°</button>
                    </div>`
        });

        r.marker = marker;
        r.infoWindow = infoWindow;

        kakao.maps.event.addListener(marker, 'click', function () {
          if (currentInfoWindow) {
            currentInfoWindow.close();
            if (currentInfoWindow === infoWindow) {
              currentInfoWindow = null;
              return;
            }
          }
          infoWindow.open(map, marker);
          currentInfoWindow = infoWindow;
        });
      });

      const button = document.getElementById("recommend-button");
      const result = document.getElementById("result");

      button.addEventListener("click", () => {
        const random = restaurants[Math.floor(Math.random() * restaurants.length)];
        result.innerHTML = `ì˜¤ëŠ˜ì€ <strong>${random.name}</strong> ì–´ë•Œìš”? ğŸ˜‹`;

        const moveLatLng = new kakao.maps.LatLng(random.lat, random.lng);
        map.setCenter(moveLatLng);
        map.setLevel(2);

        if (currentInfoWindow) currentInfoWindow.close();
        random.infoWindow.open(map, random.marker);
        currentInfoWindow = random.infoWindow;
      });
    });
  </script>
</body>
</html>
