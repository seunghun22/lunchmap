<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì™€ì´ì¦ˆì½”ì•„ ì ì‹¬ ë©”ë‰´ ì§€ë„ â€” ì—…ê·¸ë ˆì´ë“œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f3f4f6; --card:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --brand:#111827; --brand-2:#f3f4f6; --accent:#2563eb; --chip:#eef2ff; --chip-text:#3730a3;
    }
    .dark{
      --bg:#0f172a; --card:#0b1223; --text:#e5e7eb; --muted:#94a3b8; --line:#1f2a44;
      --brand:#111827; --brand-2:#0b1223; --accent:#60a5fa; --chip:#1d2a49; --chip-text:#bfdbfe;
    }
    *{box-sizing:border-box}
    html, body {margin:0; padding:0; height:100%; font-family:system-ui, -apple-system, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; color:var(--text); background:var(--bg);}    
    #app{display:grid; grid-template-rows:auto 1fr auto; min-height:100vh}

    /* í—¤ë” */
    .header{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 14px; background:var(--card); border-bottom:1px solid var(--line); position:sticky; top:0; z-index:20}
    .title{display:flex; gap:10px; align-items:center}
    .title h1{margin:0; font-size:18px}
    .actions{display:flex; gap:8px}
    .btn{height:36px; padding:0 12px; border-radius:10px; border:1px solid var(--line); background:var(--card); color:var(--text); cursor:pointer}
    .btn.primary{background:var(--accent); color:#fff; border:0}
    .btn.ghost{background:transparent}

    /* ë ˆì´ì•„ì›ƒ */
    .main{display:grid; grid-template-columns: 340px 1fr; gap:0; min-height:0}
    .sidebar{background:var(--card); border-right:1px solid var(--line); display:flex; flex-direction:column; min-height:0}
    .sidebar .filters{padding:12px; border-bottom:1px solid var(--line); display:grid; grid-template-columns:1fr 1fr; gap:8px}
    .sidebar .filters select, .sidebar .filters input{height:34px; padding:0 10px; border-radius:10px; border:1px solid var(--line); background:#fff}
    .dark .sidebar .filters select, .dark .sidebar .filters input{background:#0b1223; color:var(--text)}
    .sidebar .filters .full{grid-column:1 / -1}
    .list{overflow:auto; padding:8px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:12px; padding:10px; margin:8px 0}
    .item{display:grid; grid-template-columns: 1fr auto; gap:6px; align-items:center}
    .item h3{margin:0; font-size:16px}
    .item small{color:var(--muted)}
    .chip{display:inline-block; padding:3px 8px; border-radius:999px; background:var(--chip); color:var(--chip-text); font-size:12px; margin-right:4px}
    .row{display:flex; gap:6px; flex-wrap:wrap}

    /* ì§€ë„ */
    #map {width:100%; height: 70vh;}
    .panel{background:var(--card); border-top:1px solid var(--line); padding:14px; box-shadow:0 -6px 16px rgba(0,0,0,.04)}
    .panel h2{margin:0 0 10px; font-size:20px; display:flex; align-items:center; gap:6px}
    .cta{display:flex; gap:10px; align-items:center; justify-content:center; margin:10px 0}
    .cta .btn{box-shadow:0 8px 20px rgba(17,24,39,.12)}
    .result{margin-top:6px; text-align:center; color:var(--muted); font-size:15px}
    .history{margin-top:8px; color:var(--muted); font-size:13px; text-align:center}
    .history .pill{display:inline-block; padding:4px 10px; border-radius:999px; background:var(--chip); color:var(--chip-text); margin:4px}

    /* ì¸í¬ìœˆë„ìš° */
    .iw{padding:8px; font-size:14px; line-height:1.35}
    .iw b{display:block; margin-bottom:4px}
    .iw small{color:var(--muted)}
    .iw .btns{margin-top:6px; display:flex; gap:6px; flex-wrap:wrap}
    .iw .btns button{height:28px; padding:0 10px; border-radius:8px; border:1px solid var(--line); background:#fff; cursor:pointer}
    .iw .btns a button{background:var(--accent); color:#fff; border:0}
    .iw .btns .fav{background:#fde68a; border-color:#fcd34d}

    /* ëŒ“ê¸€/ë³„ì  */
    #comment-box{display:none; padding:16px; background:var(--card); border:1px solid var(--line); border-radius:14px; position:relative; margin-top:12px}
    #comment-title{margin:0 0 8px}
    #average-rating{position:absolute; top:14px; right:14px; font-size:14px; color:var(--muted)}
    .stars .star{font-size:22px; color:#ccc; cursor:pointer}
    .stars .star.selected{color:gold}
    #rating-info{margin-top:6px; font-size:13px; color:var(--muted)}
    #rating-submit{margin-top:10px; height:34px; padding:0 12px; border-radius:8px; border:0; background:var(--accent); color:#fff; cursor:pointer}
    #comment-list p{margin:6px 0; padding-bottom:6px; border-bottom:1px dashed var(--line)}
    textarea{width:100%; padding:10px; border:1px solid var(--line); border-radius:10px; resize:vertical}

    /* í† ìŠ¤íŠ¸ */
    .toast{position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:#111827; color:#fff; padding:10px 14px; border-radius:12px; font-size:14px; opacity:0; pointer-events:none; transition:.25s; z-index:50}
    .toast.show{opacity:1}

    /* ë°˜ì‘í˜• */
    @media (max-width: 960px){ .main{ grid-template-columns: 1fr } .sidebar{ order:2 } }
  </style>
</head>
<body>
<div id="app">
  <div class="header">
    <div class="title">
      <h1>ğŸ± ì™€ì´ì¦ˆì½”ì•„ ì ì‹¬ ì§€ë„</h1>
      <span class="chip" id="countChip">0ê³³</span>
    </div>
    <div class="actions">
      <button class="btn" id="darkToggle">ë‹¤í¬ëª¨ë“œ</button>
      <button class="btn" id="resetFav">ì¦ê²¨ì°¾ê¸° ì´ˆê¸°í™”</button>
    </div>
  </div>

 HEAD
  <!-- Kakao ì§€ë„ API -->
  <script src="//kakaoapi"></script>

  <div class="main">
    <aside class="sidebar">
      <div class="filters">
        <select id="tag" class="full">
          <option value="">ì „ì²´</option>
          <option value="êµ­ìˆ˜">êµ­ìˆ˜</option>
          <option value="ë¶„ì‹">ë¶„ì‹</option>
          <option value="í•œì‹">í•œì‹</option>
          <option value="ì¤‘ì‹">ì¤‘ì‹</option>
          <option value="ì¼ì‹">ì¼ì‹</option>
          <option value="ê¹€ë°¥">ê¹€ë°¥</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€</option>
          <option value="ì¦ê²¨ì°¾ê¸°">â­ ì¦ê²¨ì°¾ê¸°ë§Œ</option>
        </select>
        <input id="search" type="search" placeholder="ê°€ê²Œ ì´ë¦„ ê²€ìƒ‰" class="full" />
        <select id="dist">
          <option value="">ê±°ë¦¬ ì œí•œ ì—†ìŒ</option>
          <option value="200">200m ì´ë‚´</option>
          <option value="300">300m ì´ë‚´</option>
          <option value="500">500m ì´ë‚´</option>
        </select>
        <select id="sort">
          <option value="name">ì´ë¦„ìˆœ</option>
          <option value="fav">ì¦ê²¨ì°¾ê¸° ìš°ì„ </option>
          <option value="near">ê°€ê¹Œìš´ìˆœ</option>
          <option value="recent">ìµœê·¼ ì¶”ì²œ ì œì™¸</option>
        </select>
      </div>
      <div class="list" id="list"></div>
    </aside>
 81c0052 (Clean: ignore db/pyc and remove tracked artifacts)

    <section>
      <div id="map"></div>
      <div class="panel">
        <h2>ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</h2>
        <div class="cta">
          <button class="btn primary" id="recommend">ì ì‹¬ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
          <button class="btn" id="centerBtn">íšŒì‚¬ë¡œ ì´ë™</button>
          <a href="{{ url_for('dashboard') }}">
          <button class="btn">ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</button>
          </a>
        </div>
        <div id="result" class="result">ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!</div>
        <div id="history" class="history"></div>

        <!-- ëŒ“ê¸€ + ë³„ì  -->
        <div id="comment-box">
          <h3 id="comment-title">ê°€ê²Œ ì´ë¦„</h3>
          <div id="average-rating">â­ í‰ê·  ë³„ì : - / 5</div>
          <div class="stars" id="rating-stars">
            <span class="star" data-value="1">â˜…</span>
            <span class="star" data-value="2">â˜…</span>
            <span class="star" data-value="3">â˜…</span>
            <span class="star" data-value="4">â˜…</span>
            <span class="star" data-value="5">â˜…</span>
          </div>
          <div id="rating-info">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
          <button id="rating-submit">ë³„ì  ë“±ë¡</button>
          <div class="card" style="margin-top:12px">
            <div id="comment-list"></div>
            <textarea id="comment-input" rows="3" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <br />
            <button id="comment-submit" class="btn" style="margin-top:8px">ëŒ“ê¸€ ë“±ë¡</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
</div>

<!-- Kakao ì§€ë„ API -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cbbbf1aa58bda1a4274eba3bcecf5ad8&autoload=false"></script>
<!-- ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸(ì‚¬ìš©ì êµ¬í˜„) -->
<script src="{{ url_for('static', filename='js/comment.js') }}"></script>
<script src="{{ url_for('static', filename='js/rating.js') }}"></script>

<script>
// ===== ì „ì—­ ìœ í‹¸ =====
const toast = document.getElementById('toast');
function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1300); }
function favKey(name){ return `fav:${name}` }
function isFav(name){ return localStorage.getItem(favKey(name))==='1' }
function toggleFav(name){ const k=favKey(name); const v=isFav(name)?'0':'1'; localStorage.setItem(k,v); showToast(v==='1'?'ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€!':'ì¦ê²¨ì°¾ê¸° í•´ì œ!'); renderList(); filterAndRenderMarkers(); }
function pushHistory(name){ const k='lunch:history'; const arr = JSON.parse(localStorage.getItem(k) || '[]'); arr.unshift({name, t: Date.now()}); localStorage.setItem(k, JSON.stringify(arr.slice(0,8))); renderHistory(); }
function renderHistory(){ const host = document.getElementById('history'); const arr = JSON.parse(localStorage.getItem('lunch:history') || '[]'); host.innerHTML = arr.length ? 'ìµœê·¼ ì¶”ì²œ: ' + arr.map(x=>`<span class="pill">${x.name}</span>`).join('') : ''; }
function lastPickedNames(n=3){ const arr = JSON.parse(localStorage.getItem('lunch:history') || '[]'); return new Set(arr.slice(0,n).map(x=>x.name)); }
function copyLink(name, lat, lng){ const url = `https://map.kakao.com/link/to/${encodeURIComponent(name)},${lat},${lng}`; navigator.clipboard.writeText(url).then(()=>showToast('ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° ë§í¬ ë³µì‚¬!')); }
function kakaoPlaceUrl(id){ return `https://place.map.kakao.com/${id}` }
function showComments(name){ const box=document.getElementById('comment-box'); document.getElementById('comment-title').textContent=name; box.style.display='block'; if (window.loadCommentsFor) window.loadCommentsFor(name); if (window.loadRatingFor) window.loadRatingFor(name); }
function showRating(name){ showComments(name); }

// ===== ë°ì´í„° =====
const OFFICE = { lat: 37.510488831985356, lng: 127.02311875262234 };
const restaurants = [
  { name: "ì‹¸ë‹¤ê¹€ë°¥", lat: 37.510604190067994, lng: 127.02052018667223, tags:["ê¹€ë°¥","ë¶„ì‹"], placeId: 1435494356 },
  { name: "ë§ˆë‹˜ê¹€ë°¥", lat: 37.51081997319398, lng: 127.02300574881384, tags:["ê¹€ë°¥","ë¶„ì‹"], placeId: 1246921124 },
  { name: "ì €ìŠ¤íŠ¸ì¹´ì¸ ", lat: 37.5107478900872,  lng: 127.02301986491916, tags:["ì¼ì‹"], placeId: 157382006 },
  { name: "íƒ•íƒ•ì§‘",   lat: 37.51064201820906, lng: 127.02303962589788, tags:["í•œì‹"], placeId: 170461079 },
  { name: "ë¶€ëŒ€ì°Œê°œ", lat: 37.5101642869389,  lng: 127.02403763026003, tags:["í•œì‹"], placeId: 1223656944 },
  { name: "ìˆœëŒ€êµ­",   lat: 37.50963517755151, lng: 127.02287531540941, tags:["í•œì‹"], placeId: 912621785 },
  { name: "ë³´ìŠ¹íšŒê´€", lat: 37.50850679867281, lng: 127.02219635636679, tags:["í•œì‹"], placeId: 1527942162 },
  { name: "íšŒë®ë°¥,ì•Œë°¥", lat: 37.50782845013411, lng: 127.02394922764212, tags:["ì¼ì‹"], placeId: 535918986 },
  { name: "ì„œë¸Œì›¨ì´", lat: 37.50950926196295, lng: 127.02168203016542, tags:["ê¸°íƒ€"] , placeId: 26484597 },
  { name: "ë¼ˆí•´ì¥êµ­ì§‘", lat: 37.51097097543822, lng: 127.02257033640775, tags:["í•œì‹"] , placeId: 243565590 },
  { name: "ë³¸ì£½,ë¹„ë¹”ë°¥", lat: 37.510563108050185,lng: 127.02340719469315, tags:["í•œì‹"] , placeId: 156295439 },
  { name: "ìˆœë‘ë¶€",   lat: 37.510491022649205, lng: 127.02343262090795, tags:["í•œì‹"] , placeId: 1385258074},
  { name: "ìŒ€êµ­ìˆ˜",   lat: 37.51081583910813,  lng: 127.02101508308174, tags:["ì¤‘ì‹"] , placeId:1174806960 },
  { name: "ì‹œì¥ í•œì–‘ê¹€ë°¥êµ­ìˆ˜", lat: 37.509621530803585, lng: 127.0235454532333, tags:["êµ­ìˆ˜","ë¶„ì‹","ê¹€ë°¥"] , placeId: 729741537 },
  { name: "ì œìœ¡,ê¹€ì¹˜ì°Œê°œ ë¼ì§€ê°€", lat: 37.51009019196013, lng: 127.02283869519349, tags:["í•œì‹"], placeId: 1771055449 },
  { name: "ì†êµ­ì‹œ",   lat: 37.509986531382246, lng: 127.02307052821175, tags:["êµ­ìˆ˜","í•œì‹"] , placeId: 13624172  },
  { name: "í•¨ë°”ì§‘,í•œì‹ë·”í˜", lat: 37.50976133295169, lng: 127.02279900847579, tags:["í•œì‹"], placeId: 642462680 },
  { name: "ë§ˆë¼íƒ•",   lat: 37.510382583361285, lng: 127.02498778462514, tags:["ì¤‘ì‹"], placeId: 1827179958 },
  { name: "ì˜¤ë´‰ì§‘",   lat: 37.50836688742737,  lng: 127.0235167835929,  tags:["í•œì‹"], placeId: 928511632 },
  { name: "í¸ì˜ì ",   lat: 37.510560860579325, lng: 127.02338174524247, tags:["ê¸°íƒ€"], placeId: 19205791 },
  { name: "ë¶€ì—‰ì´ì‹ë‹¹", lat: 37.51173627012451, lng: 127.02532755787342, tags:["í•œì‹"], placeId: 1465574297 },
  { name: "ë¼ˆì°œê´€",   lat: 37.50909452023658, lng: 127.02315508118194, tags:["í•œì‹"], placeId: 1074225216 },
  { name: "ë¸Œë£¨í´ë¦°í",  lat: 37.51119376664262, lng: 127.02363077698234, tags:["ì–‘ì‹"], placeId: 1667365640}
];

// ê±°ë¦¬ ê³„ì‚° (ë¯¸í„°)
function distanceMeters(a, b){
  const R=6371000; const toRad=x=>x*Math.PI/180;
  const dLat=toRad(b.lat-a.lat), dLng=toRad(b.lng-a.lng);
  const A = Math.sin(dLat/2)**2 + Math.cos(toRad(a.lat))*Math.cos(toRad(b.lat))*Math.sin(dLng/2)**2;
  return 2*R*Math.asin(Math.sqrt(A));
}

// ===== Kakao ì§€ë„ ì´ˆê¸°í™” =====
let map, markerImage, currentInfoWindow=null;
const markers = new Map(); // name -> marker

document.getElementById('centerBtn').onclick = () => { if(map){ map.setCenter(new kakao.maps.LatLng(OFFICE.lat, OFFICE.lng)); map.setLevel(2); }}

document.getElementById('darkToggle').onclick = () => { document.body.classList.toggle('dark'); localStorage.setItem('lunch:dark', document.body.classList.contains('dark')?'1':'0'); };
if(localStorage.getItem('lunch:dark')==='1') document.body.classList.add('dark');

document.getElementById('resetFav').onclick = () => { Object.keys(localStorage).forEach(k=>{ if(k.startsWith('fav:')) localStorage.removeItem(k); }); showToast('ì¦ê²¨ì°¾ê¸° ì´ˆê¸°í™” ì™„ë£Œ'); renderList(); filterAndRenderMarkers(); };

kakao.maps.load(function(){
  map = new kakao.maps.Map(document.getElementById('map'), { center: new kakao.maps.LatLng(OFFICE.lat, OFFICE.lng), level: 2 });
  markerImage = new kakao.maps.MarkerImage("https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png", new kakao.maps.Size(36,36));

  // ë§ˆì»¤ êµ¬ì„±
  restaurants.forEach(r=>{
    const marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(r.lat, r.lng), map, title:r.name, image: markerImage });
    const reviewBtn = r.placeId ? `<a href="${kakaoPlaceUrl(r.placeId)}" target="_blank"><button>ë¦¬ë·°</button></a>` : '';
    const iw = new kakao.maps.InfoWindow({ content:
      `<div class="iw">
        <b>${r.name}</b>
        <small>${(r.tags||[]).join(' / ')}</small>
        <div class="btns">
          ${reviewBtn}
          <button onclick="showComments('${r.name}')">ëŒ“ê¸€</button>
          <button onclick="showRating('${r.name}')">ë³„ì </button>
          <button class="fav" onclick="toggleFav('${r.name}')">â­ ì¦ê²¨ì°¾ê¸°</button>
          <button onclick="copyLink('${r.name}', ${r.lat}, ${r.lng})">ê¸¸ì°¾ê¸° ë§í¬</button>
        </div>
      </div>` });
    r.marker = marker; r.infoWindow = iw; markers.set(r.name, marker);

    kakao.maps.event.addListener(marker, 'click', function(){
      if (currentInfoWindow) currentInfoWindow.close();
      iw.open(map, marker); currentInfoWindow = iw; focusListItem(r.name);
    });

    kakao.maps.event.addListener(marker, 'dblclick', function(){ if(r.placeId) window.open(kakaoPlaceUrl(r.placeId), '_blank'); });
  });

  renderList();
  filterAndRenderMarkers();
  renderHistory();
});

// ===== ë¦¬ìŠ¤íŠ¸ ë Œë” & í•„í„° =====
const listHost = document.getElementById('list');
const countChip = document.getElementById('countChip');
const tagSel = document.getElementById('tag');
const searchInput = document.getElementById('search');
const distSel = document.getElementById('dist');
const sortSel = document.getElementById('sort');

tagSel.onchange = distSel.onchange = sortSel.onchange = () => { renderList(); filterAndRenderMarkers(); };
searchInput.oninput = () => { renderList(); };

function filtered(){
  const tag = tagSel.value; const q = searchInput.value.trim(); const dist = +(distSel.value||0);
  const lastSet = lastPickedNames(3); // ìµœê·¼ 3íšŒ ì œì™¸ ì˜µì…˜ìš©
  let arr = restaurants.map(r=> ({...r}));
  if(tag==='ì¦ê²¨ì°¾ê¸°') arr = arr.filter(r=>isFav(r.name));
  else if(tag) arr = arr.filter(r=> r.tags && r.tags.includes(tag));
  if(q) arr = arr.filter(r=> r.name.toLowerCase().includes(q.toLowerCase()));
  if(dist){ arr = arr.filter(r=> distanceMeters(OFFICE, r) <= dist); }
  const sort = sortSel.value;
  if(sort==='fav') arr.sort((a,b)=> (isFav(b.name)-isFav(a.name)) || a.name.localeCompare(b.name));
  else if(sort==='near') arr.sort((a,b)=> distanceMeters(OFFICE,a)-distanceMeters(OFFICE,b));
  else if(sort==='recent') arr = arr.filter(r=> !lastSet.has(r.name));
  else arr.sort((a,b)=> a.name.localeCompare(b.name));
  return arr;
}

function renderList(){
  const arr = filtered();
  countChip.textContent = `${arr.length}ê³³`;
  listHost.innerHTML = '';
  arr.forEach(r=>{
    const d = Math.round(distanceMeters(OFFICE, r));
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `
      <div class="item">
        <div>
          <h3>${r.name} ${isFav(r.name)?'â­':''}</h3>
          <small>${(r.tags||[]).map(t=>`<span class='chip'>${t}</span>`).join(' ')} Â· ì•½ ${d}m</small>
        </div>
        <div class="row">
          <button class="btn" data-act="center">ì§€ë„</button>
          <button class="btn" data-act="open">ì—´ê¸°</button>
          <button class="btn" data-act="fav">â­</button>
        </div>
      </div>
    `;
    el.querySelector('[data-act="center"]').onclick = ()=>{ centerAndOpen(r); };
    el.querySelector('[data-act="open"]').onclick = ()=>{ showComments(r.name); centerAndOpen(r); };
    el.querySelector('[data-act="fav"]').onclick = ()=>{ toggleFav(r.name); renderList(); };
    el.dataset.name = r.name;
    listHost.appendChild(el);
  });
}

function focusListItem(name){
  const el = [...listHost.children].find(x=>x.dataset.name===name); if(!el) return; el.scrollIntoView({behavior:'smooth', block:'center'}); el.style.outline='2px solid var(--accent)'; setTimeout(()=> el.style.outline='none', 1200);
}

function centerAndOpen(r){
  const pos = new kakao.maps.LatLng(r.lat, r.lng); map.setCenter(pos); map.setLevel(2);
  if (currentInfoWindow) currentInfoWindow.close(); r.infoWindow.open(map, r.marker); currentInfoWindow=r.infoWindow;
}

function filterAndRenderMarkers(){
  const names = new Set(filtered().map(r=>r.name));
  restaurants.forEach(r=>{ if(!r.marker) return; r.marker.setMap( names.has(r.name) ? map : null ); });
}

// ===== ì¶”ì²œ ë¡œì§ =====
function pickWeighted(list){
  const lastSet = lastPickedNames(2); // ë°”ë¡œ ì§ì „ 2íšŒëŠ” ê°€ì¤‘ì¹˜ ë‚®ì¶¤
  const weights = list.map(r=>{
    let w = isFav(r.name) ? 4 : 1; // ì¦ê²¨ì°¾ê¸° ê°€ì¤‘ì¹˜
    if(lastSet.has(r.name)) w *= 0.3; // ìµœê·¼ ì„ íƒ ê°ì 
    return w;
  });
  const total = weights.reduce((a,b)=>a+b,0); let rnd=Math.random()*total;
  for(let i=0;i<list.length;i++){ if((rnd-=weights[i])<0) return list[i]; }
  return list[0];
}

document.getElementById('recommend').addEventListener('click', ()=>{
  const arr = filtered(); const result = document.getElementById('result');
  if(arr.length===0){ result.innerHTML = 'ì¡°ê±´ì— ë§ëŠ” í›„ë³´ê°€ ì—†ì–´ìš” ğŸ˜¥'; return; }
  const pick = pickWeighted(arr);
  const review = pick.placeId? ` <a href="${kakaoPlaceUrl(pick.placeId)}" target="_blank">ë¦¬ë·°</a>`:'';
  result.innerHTML = `ì˜¤ëŠ˜ì€ <strong>${pick.name}</strong> ì–´ë–¤ê°€ìš”? ğŸ˜‹${review}`;
  centerAndOpen(pick); pushHistory(pick.name);
});

renderHistory();
</script>
</body>
</html>
